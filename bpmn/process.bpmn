<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<definitions xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:modeler="http://camunda.org/schema/modeler/1.0" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" id="definitions_1d5ddc4e-7f57-413a-a00e-888e9b9a2a48" targetNamespace="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL">
  <process id="process_97d2d1a0-0376-4108-b214-5d829da89270" isExecutable="true">
    <startEvent id="start" name="start">
      <outgoing>sequenceFlow_d5c22567-d96a-470b-b0f5-48e9ff5be78c</outgoing>
    </startEvent>
    <serviceTask id="check_customer" name="check_customer" zeebe:modelerTemplate="io.holunda.connector.database.v1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik0zLjE3MDA0IDcuNDM5OTRMMTIgMTIuNTQ5OUwyMC43NyA3LjQ2OTkxIiBzdHJva2U9IiMyOTJEMzIiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCjxwYXRoIGQ9Ik0xMiAyMS42MDk5VjEyLjUzOTkiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPHBhdGggZD0iTTIxLjYxIDEyLjgzVjkuMTdDMjEuNjEgNy43OSAyMC42MiA2LjExMDAyIDE5LjQxIDUuNDQwMDJMMTQuMDcgMi40OEMxMi45MyAxLjg0IDExLjA3IDEuODQgOS45Mjk5OSAyLjQ4TDQuNTkgNS40NDAwMkMzLjM4IDYuMTEwMDIgMi4zOTAwMSA3Ljc5IDIuMzkwMDEgOS4xN1YxNC44M0MyLjM5MDAxIDE2LjIxIDMuMzggMTcuODkgNC41OSAxOC41Nkw5LjkyOTk5IDIxLjUyQzEwLjUgMjEuODQgMTEuMjUgMjIgMTIgMjJDMTIuNzUgMjIgMTMuNSAyMS44NCAxNC4wNyAyMS41MiIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8cGF0aCBkPSJNMTkuMiAyMS40QzIwLjk2NzMgMjEuNCAyMi40IDE5Ljk2NzMgMjIuNCAxOC4yQzIyLjQgMTYuNDMyNyAyMC45NjczIDE1IDE5LjIgMTVDMTcuNDMyNyAxNSAxNiAxNi40MzI3IDE2IDE4LjJDMTYgMTkuOTY3MyAxNy40MzI3IDIxLjQgMTkuMiAyMS40WiIgc3Ryb2tlPSIjMjkyRDMyIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+DQo8cGF0aCBkPSJNMjMgMjJMMjIgMjEiIHN0cm9rZT0iIzI5MkQzMiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPg0KPC9zdmc+" zeebe:modelerTemplateVersion="1">
      <extensionElements>
        <zeebe:taskDefinition type="gpt-database"/>
        <zeebe:ioMapping>
          <zeebe:input source="postgresql://postgres:postgres@localhost:5438/postgres" target="databaseUrl"/>
          <zeebe:input source="NULL" target="missingDataBehavior"/>
          <zeebe:input source="secrets.OPENAI_API_KEY" target="apiKey"/>
          <zeebe:input source="GPT_4" target="model"/>
          <zeebe:input source="={&#10;  customer_email : customer_email&#10;}" target="inputJson"/>
          <zeebe:input source="Check if the customer with this email exists in the database" target="taskDescription"/>
          <zeebe:input source="={&#10;  &quot;exists&quot; : {&#10;    &quot;type&quot; : &quot;boolean&quot;,&#10;    &quot;description&quot; : &quot;whether the customer exists in the database&quot;&#10;  }&#10;}" target="outputSchema"/>
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultExpression" value="={customer_data: result}"/>
        </zeebe:taskHeaders>
      </extensionElements>
      <incoming>sequenceFlow_d5c22567-d96a-470b-b0f5-48e9ff5be78c</incoming>
      <outgoing>sequenceFlow_1ac860d1-aa17-4709-bba8-d69633833063</outgoing>
    </serviceTask>
    <sequenceFlow id="sequenceFlow_d5c22567-d96a-470b-b0f5-48e9ff5be78c" sourceRef="start" targetRef="check_customer"/>
    <exclusiveGateway id="customer_exists" name="customer_exists">
      <incoming>sequenceFlow_1ac860d1-aa17-4709-bba8-d69633833063</incoming>
      <outgoing>sequenceFlow_4bb769c8-00fe-4843-bea8-8abe73681e8e</outgoing>
      <outgoing>sequenceFlow_2f82d81b-2dff-4d5a-aa8b-c138548a9662</outgoing>
    </exclusiveGateway>
    <sequenceFlow id="sequenceFlow_1ac860d1-aa17-4709-bba8-d69633833063" sourceRef="check_customer" targetRef="customer_exists"/>
    <sequenceFlow id="sequenceFlow_4bb769c8-00fe-4843-bea8-8abe73681e8e" sourceRef="customer_exists" targetRef="end_exists">
      <conditionExpression id="conditionExpression_8dfdd9dd-b4c9-4c5d-adf2-cfda5b4bf33a">=customer_data.exists</conditionExpression>
    </sequenceFlow>
    <endEvent id="end_exists" name="end_exists">
      <incoming>sequenceFlow_4bb769c8-00fe-4843-bea8-8abe73681e8e</incoming>
    </endEvent>
    <sequenceFlow id="sequenceFlow_2f82d81b-2dff-4d5a-aa8b-c138548a9662" sourceRef="customer_exists" targetRef="end">
      <conditionExpression id="conditionExpression_15a3b492-2bf1-44cc-8352-5653a0659150">=customer_data.exists = false</conditionExpression>
    </sequenceFlow>
    <endEvent id="end" name="end">
      <incoming>sequenceFlow_2f82d81b-2dff-4d5a-aa8b-c138548a9662</incoming>
    </endEvent>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_5ef767b8-676b-4298-964b-21c933fae532">
    <bpmndi:BPMNPlane bpmnElement="process_97d2d1a0-0376-4108-b214-5d829da89270" id="BPMNPlane_73b7edcd-62b5-4f1e-b7b9-c1da0623628f">
      <bpmndi:BPMNShape bpmnElement="start" id="BPMNShape_a2dabed4-faa9-432a-8a57-25942a4447e9">
        <dc:Bounds height="36.0" width="36.0" x="100.0" y="100.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="check_customer" id="BPMNShape_415f0094-ceff-4faf-9ab4-d89ee6ab6b31">
        <dc:Bounds height="80.0" width="100.0" x="186.0" y="78.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="sequenceFlow_d5c22567-d96a-470b-b0f5-48e9ff5be78c" id="BPMNEdge_b76a2649-3d04-4b18-99ad-29531112d809">
        <di:waypoint x="136.0" y="118.0"/>
        <di:waypoint x="186.0" y="118.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape bpmnElement="customer_exists" id="BPMNShape_77ae0625-e9d7-4652-a159-b26eb7026817" isMarkerVisible="true">
        <dc:Bounds height="50.0" width="50.0" x="336.0" y="93.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="sequenceFlow_1ac860d1-aa17-4709-bba8-d69633833063" id="BPMNEdge_de910812-0bba-4dde-a636-2105f07150c9">
        <di:waypoint x="286.0" y="118.0"/>
        <di:waypoint x="336.0" y="118.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape bpmnElement="end_exists" id="BPMNShape_2687238e-213a-4369-95d7-3a3964222f53">
        <dc:Bounds height="36.0" width="36.0" x="436.0" y="100.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="sequenceFlow_4bb769c8-00fe-4843-bea8-8abe73681e8e" id="BPMNEdge_ed0488f4-f5c9-45bf-9162-dca822641b23">
        <di:waypoint x="386.0" y="118.0"/>
        <di:waypoint x="436.0" y="118.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape bpmnElement="end" id="BPMNShape_5516105e-ea8c-4d48-8636-8c9ca930e0cd">
        <dc:Bounds height="36.0" width="36.0" x="436.0" y="186.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="sequenceFlow_2f82d81b-2dff-4d5a-aa8b-c138548a9662" id="BPMNEdge_6234b66b-4de9-472b-8a9e-0e5ecb0e3786">
        <di:waypoint x="361.0" y="143.0"/>
        <di:waypoint x="361.0" y="204.0"/>
        <di:waypoint x="436.0" y="204.0"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
